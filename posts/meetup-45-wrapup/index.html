<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Hybrid Meetup #45 wrap-up | Leipzig Gophers</title>

    <style>body{margin:1em auto;padding:1em;color:#2f2d2e;max-width:45em;line-height:1.6;font-family:Georgia,serif;font-size:1.2em}h1{border-bottom:2pt solid #2f2d2e}.header-menu{float:right}ul.pagination{list-style-type:none;text-align:center;padding:0}ul.pagination>li{padding:0 .4em;display:inline-block}div.footer{border-top:1pt solid;text-align:center;padding:1em}img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}@media(min-width:45em){div.tags{float:right}}img[src*="#half"]{width:50%}a{text-decoration:none;color:#35a7ff;border-bottom:2pt solid #fff}a:visited{color:#ff5964}a:hover{border-bottom:2pt solid #ff5964;transition:all 333ms ease-in}a.tag{padding:.1em .4em;background:#2f2d2e;color:#fff;text-decoration:none;border-radius:5pt}a.anchor{padding-right:.3em}blockquote{color:#838383}</style>

    

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name='impact-site-verification' value='54840aba-1503-416b-b5d7-dafee41af763'> 



</head>


<body>
<div class="header">
    <a href="/">Leipzig Gophers</a>
    <div class="header-menu">
        <a href="/posts/">blog</a>
    </div>
</div>
<div id="content">

<header>
    <h1 id="#hybrid-meetup-45-wrap-up">
        <a class="anchor" href="#hybrid-meetup-45-wrap-up">ðŸ”—</a>Hybrid Meetup #45 wrap-up</h1>
    

<div class="post-meta"><time datetime="2024-11-14">Nov 14, 2024</time><div class="tags">
        Tags
        <a class="tag" href="https://golangleipzig.space/tags/summary/">summary</a>
        <a class="tag" href="https://golangleipzig.space/tags/meetup/">meetup</a>
    </div>
</div>
</header>
<article>
    <h2 id="testing-in-go">Testing in Go</h2>
<p>Hybrid Meetup #45 took place
<a href="https://www.meetup.com/leipzig-golang/events/298481354/">2024-10-29</a> 19:00 at
<a href="https://check24.de">CHECK24</a> Leipzig Office at Altes Landratsamt and we were
thrilled to see people joining from Leipzig
<a href="https://en.wikipedia.org/wiki/Saxony-Anhalt">and</a>
<a href="https://en.wikipedia.org/wiki/Thuringia">beyond</a>, both on site and online. We
had two great input presentations about open source projects in the testing
domain.</p>
<h3 id="coverage-metrics">Coverage metrics</h3>
<p><a href="https://www.linkedin.com/in/fabian-g%C3%A4rtner-913584141/">Fabian</a> analyzed
the Go coverage tool <a href="https://pkg.go.dev/cmd/cover">cmd/cover</a>, listed some of
its shortcomings and demonstrated a tool to address them and to improve some
metrics: <a href="https://github.com/Fabianexe/gocoverageplus">gocoverageplus</a>.</p>
<p>The coverage tool shipped with Go operates on the source code and uses
instrumentation to estimate coverage:</p>
<blockquote>
<p>When generated instrumented code, the cover tool computes approximate
basic block information by studying the source. It is thus more portable than
binary-rewriting coverage tools, but also a little less capable. For instance,
it does not probe inside &amp;&amp; and || expressions, and can be mildly confused by
single statements with multiple function literals. &ndash; <a href="https://pkg.go.dev/cmd/cover">cmd/cover</a></p>
</blockquote>
<p>In the past, go cover had a couple of issues, among them:
<a href="https://github.com/golang/go/issues/23883">#23883</a>,
<a href="https://github.com/golang/go/issues/51430">#51430</a>,
<a href="https://github.com/golang/go/issues/58770">#58770</a>,
<a href="https://github.com/golang/go/issues/65570">#65570</a>,
<a href="https://github.com/golang/go/issues/65653">#65653</a>, &hellip;</p>
<p>Also, there is a currently open proposal:</p>
<ul>
<li><a href="https://github.com/golang/go/issues/70306">proposal: cmd/cover: support branch coverage</a></li>
</ul>
<blockquote>
<p>Adding <strong>branch coverage</strong> would be beneficial, as it would allow developers to
better understand which branches (conditional paths) in their code are being
executed during tests, rather than just which lines.</p>
</blockquote>
<p>The <a href="https://github.com/Fabianexe/gocoverageplus">gocoverageplus</a> addresses
some of these shortcomings and also supports
<a href="https://gcovr.com/en/stable/output/cobertura.html">cobertura</a> output format, as well as complexity metrics.</p>
<p>A short usage demo:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ go install github.com/Fabianexe/gocoverageplus@latest
$ go <span style="color:#0086b3">test</span> -cover -coverprofile<span style="color:#000;font-weight:bold">=</span>c.out
</code></pre></div><p>Put a <a href="https://github.com/Fabianexe/gocoverageplus/?tab=readme-ov-file#config">config
file</a>
into your projects folder, then:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">$ gocoverageplus -i c.out -o p.out
</code></pre></div><p>Then render the report, e.g. as HTML or to stdout. A nice little TUI for
coverage reports is: <a href="https://github.com/orlangure/gocovsh">gocovsh</a>.</p>
<p><a href="https://github.com/orlangure/gocovsh"><img src="/images/gocovsh.png" alt=""></a></p>
<h3 id="go-scheduler-overlay">Go scheduler overlay</h3>
<p>We took another look on testing, through the lens of <a href="https://github.com/Metamogul/timestone">timestone</a>,</p>
<blockquote>
<p>a library to create deterministic and easy-to-understand unit tests for time-dependent, concurrent go code.</p>
</blockquote>
<p>It requires modification of existing code (replace go routine invocations with
timestone), but after that, tests can be run in either with the system
scheduler, i.e. <a href="https://github.com/Metamogul/timestone/blob/7411decd9b3e1e28ef539e2bbb0ebb67b9e059d7/system/scheduler.go#L20-L29">using
goroutines</a>
or a <a href="https://github.com/Metamogul/timestone/blob/7411decd9b3e1e28ef539e2bbb0ebb67b9e059d7/simulation/scheduler.go#L149-L155">simulation
scheduler</a>,
that gives the caller control over the process execution.</p>
<p>By default, Go programs can exhibit non-determinism in a few places, among others in:</p>
<ul>
<li>randomized work stealing in the <a href="https://github.com/golang/go/blob/8e714281e441f93d2865adb3c5a507fd161314e9/src/runtime/proc.go#L7198">scheduler</a></li>
<li>randomized map <a href="https://github.com/golang/go/blob/8b0ac33da8574b74ba50ad727b59fa8679d93e4b/src/internal/runtime/maps/map.go#L141-L142">iteration</a></li>
<li>randomized <a href="https://github.com/golang/go/blob/8e714281e441f93d2865adb3c5a507fd161314e9/src/runtime/select.go#L181">select clause</a></li>
</ul>
<p>With <a href="https://github.com/Metamogul/timestone">timestone</a>, it is possible to get
around the scheduling randomness, when this interferes with test results. Check
out some of the examples included in the library, here:
<a href="https://github.com/Metamogul/timestone/tree/main/examples">timestone/examples</a>.</p>
<h3 id="misc">Misc</h3>
<ul>
<li>for integration testing, <a href="https://golang.testcontainers.org/">testcontainers</a>
can come in handy; you can simulate the actual services your code interfaces
with, like key-value stores, object stores, search engines, databases, etc. &ndash; a handy, albeit slightly slower, alternative to mock objects</li>
<li>for a more unusual test setup, see this lightning talk about <a href="https://www.youtube.com/watch?v=69Zy77O-BUM">running go tests in a VM w/ qemu</a></li>
</ul>

</article>


    </div>
<div class="footer">
    
    
    <div class="footer-links">
        <a href="https://www.meetup.com/Leipzig-Golang/">Meetup</a><span> / <span><a href="https://github.com/golang-leipzig">GitHub</a><span> / <span><a href="https://raw.githubusercontent.com/golang-leipzig/golang-leipzig.github.io/source/Impressum.txt">Imprint</a><span> / <span><a href="/qr.png">QR</a><span> / <span><a href="https://1mb.club/">1MB</a></div>
    

    
    
</div>
</body>

</html>