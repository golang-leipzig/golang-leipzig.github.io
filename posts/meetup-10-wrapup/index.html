<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Virtual Meetup #10 wrap-up | Leipzig Gophers</title>

    <style>body{margin:1em auto;padding:1em;color:#2f2d2e;max-width:45em;line-height:1.6;font-family:Georgia,serif;font-size:1.2em}h1{border-bottom:2pt solid #2f2d2e}.header-menu{float:right}ul.pagination{list-style-type:none;text-align:center;padding:0}ul.pagination>li{padding:0 .4em;display:inline-block}div.footer{border-top:1pt solid;text-align:center;padding:1em}img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}@media(min-width:45em){div.tags{float:right}}img[src*="#half"]{width:50%}a{text-decoration:none;color:#35a7ff;border-bottom:2pt solid #fff}a:visited{color:#ff5964}a:hover{border-bottom:2pt solid #ff5964;transition:all 333ms ease-in}a.tag{padding:.1em .4em;background:#2f2d2e;color:#fff;text-decoration:none;border-radius:5pt}a.anchor{padding-right:.3em}</style>

    

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

</head>


<body>
<div class="header">
    <a href="/">Leipzig Gophers</a>
    <div class="header-menu">
        <a href="/posts/">blog</a>
    </div>
</div>
<div id="content">

<header>
    <h1 id="#virtual-meetup-10-wrap-up">
        <a class="anchor" href="#virtual-meetup-10-wrap-up">ðŸ”—</a>Virtual Meetup #10 wrap-up</h1>
    

<div class="post-meta"><time datetime="2020-04-21">Apr 21, 2020</time><div class="tags">
        Tags
        <a class="tag" href="https://golang-leipzig.github.io/tags/summary/">summary</a>
        <a class="tag" href="https://golang-leipzig.github.io/tags/meetup/">meetup</a>
    </div>
</div>
</header>
<article>
    <h2 id="the-sync-package">
  <a class="anchor" href="#the-sync-package">ðŸ”—</a>
  The sync package
</h2>

<p>Virtual <a href="https://www.meetup.com/Leipzig-Golang/events/268785531/">Meetup #10</a>
took place on Friday, April 17, 2020, 19:00 CEST via <a href="https://zoom.us/">Zoom</a>
(thanks to <a href="https://github.com/saschagrunert">saschagrunert</a> and
<a href="https://www.cncf.io/">CNCF</a>).</p>
<p><a href="https://twitter.com/embano1">Michael</a> prepared a <a href="https://github.com/embano1/go-meetup-lej-04-2020">great overview</a> of the
<a href="https://golang.org/pkg/sync/">sync</a> and
<a href="https://pkg.go.dev/golang.org/x/sync">x/sync</a> packages, which implement
concurrency related facilities (concurrency is hard with either classical
approaches or CSP, as we <a href="https://speakerdeck.com/embano1/concurrency-bugs-in-go-go-meetup-leipzig-03-15-2019-gasch">learned from a
presentation</a>
last year at <a href="https://golangleipzig.space/posts/second-meetup-wrapup/">meetup #2</a>).</p>
<p>The overview included among other things a bug hunt in a
<a href="https://github.com/embano1/go-meetup-lej-04-2020/blob/master/sync/sync-rwmutex/counter.go">counter</a>
example and a benchmark of the builtin <a href="https://golang.org/ref/spec#Map_types">map</a>
and <a href="https://golang.org/pkg/sync/#Map">sync.Map</a>.</p>
<p><img src="/images/sync-map-bench.png" alt=""></p>
<p>The <a href="https://pkg.go.dev/mod/golang.org/x/sync">x/sync</a> contains the very useful
<a href="https://github.com/embano1/go-meetup-lej-04-2020/tree/master/x-sync/errgroup">errgroup</a>
and
<a href="https://github.com/embano1/go-meetup-lej-04-2020/tree/master/x-sync/singleflight">singleflight</a>.</p>
<p>One thing that the <a href="https://godoc.org/golang.org/x/sync/errgroup">errgroup</a>
will not provide for out of the box is the pickup of multiple error, should
more than one occur.</p>
<blockquote>
<p>Go calls the given function in a new goroutine. The <strong>first call</strong> to return a non-nil error cancels the group; its error will be returned by Wait. &ndash; <a href="https://godoc.org/golang.org/x/sync/errgroup#Group.Go">https://godoc.org/golang.org/x/sync/errgroup#Group.Go</a></p>
</blockquote>
<p>And:</p>
<blockquote>
<p>Wait blocks until all function calls from the Go method have returned, then
returns the <strong>first non-nil error</strong> (if any) from them. &ndash; <a href="https://godoc.org/golang.org/x/sync/errgroup#Group.Wait">https://godoc.org/golang.org/x/sync/errgroup#Group.Wait</a></p>
</blockquote>
<p>An implementation of this feature can be found in <a href="https://github.com/kubernetes/apimachinery">k8s apimachinery&rsquo;s</a> <a href="https://github.com/kubernetes/apimachinery/blob/06deae5c9c2c030d771a467e086b6c791e8800dc/pkg/util/errors/errors.go#L231-L246">error
utilities</a>.</p>
<p>The singleflight pattern can also be found in the perkeep utils <a href="https://github.com/go4org/go4">go4</a> repository, in the <a href="https://github.com/go4org/go4/blob/f5505b9728ddf920bb673137648788c5ac99de1b/syncutil/singleflight/singleflight.go#L17-L19">singleflight</a> package.</p>
<blockquote>
<p>Package singleflight provides a duplicate function call suppression mechanism.</p>
</blockquote>
<p>The way to <a href="https://github.com/go4org/go4/blob/f5505b9728ddf920bb673137648788c5ac99de1b/syncutil/singleflight/singleflight_test.go#L55-L85">test
singleflight</a>
can be interesting, too. One pools up a number of goroutines (by starting and
waiting a bit). Then, a single value sent on a channel serves as a starting
shot. At the same time, the atomic counter on calls ensure there has only been
a single function call.</p>
<h2 id="misc">
  <a class="anchor" href="#misc">ðŸ”—</a>
  Misc
</h2>

<p>In one of the upcoming meetups, we will highlight tools from the
<a href="https://github.com/hashicorp/">Hashicorp stack</a>, as there is certainly in
interest in these tools.</p>
<p>Go can be a glue language, e.g. to combine exiting, tested tools with some thin
convenience layer. On a lighter side, this is what
<a href="https://github.com/miku/ttarc">ttarc</a> does, a
<a href="https://www.tiktok.com/">TikTok</a> archiving tool: It wraps
<a href="https://www.gnu.org/software/wget/">wget</a> with a bit of networking and JSON
parsing to generate <a href="https://en.wikipedia.org/wiki/Web_ARChive">WARC</a> files.</p>
<p><img src="/images/pix.png" alt=""></p>

</article>


    </div>
<div class="footer">
    
    
    <div class="footer-links">
        <a href="https://www.meetup.com/Leipzig-Golang/">Meetup</a><span> / <span><a href="https://github.com/golang-leipzig">GitHub</a><span> / <span><a href="https://raw.githubusercontent.com/golang-leipzig/golang-leipzig.github.io/source/Impressum.txt">Impressum</a></div>
    

    
    
</div>
</body>

</html>